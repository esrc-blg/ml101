<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 All non-linear (polynomials to splines) | Introduction to Data Science</title>
  <meta name="description" content="Chapter 6 All non-linear (polynomials to splines) | Introduction to Data Science" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 All non-linear (polynomials to splines) | Introduction to Data Science" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 All non-linear (polynomials to splines) | Introduction to Data Science" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="seminar5.html">
<link rel="next" href="seminar7.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="lib/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="js/codefolding.js"></script>


<script>
$(document).ready(function () {
  window.initializeCodeFolding();
});
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="lib\bootstrap\3.3.7\css\bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="css\readthedocs.css" type="text/css" />
<link rel="stylesheet" href="css\custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this course</a></li>
<li class="chapter" data-level="1" data-path="seminar1.html"><a href="seminar1.html"><i class="fa fa-check"></i><b>1</b> Linear Regression</a><ul>
<li class="chapter" data-level="1.1" data-path="seminar1.html"><a href="seminar1.html#learning-objectives"><i class="fa fa-check"></i><b>1.1</b> Learning objectives</a><ul>
<li class="chapter" data-level="1.1.1" data-path="seminar1.html"><a href="seminar1.html#dplyr-package"><i class="fa fa-check"></i><b>1.1.1</b> Dplyr package</a></li>
<li class="chapter" data-level="1.1.2" data-path="seminar1.html"><a href="seminar1.html#visualising-a-relationship-bw-two-continuous-variables"><i class="fa fa-check"></i><b>1.1.2</b> Visualising a relationship b/w two continuous variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="seminar2.html"><a href="seminar2.html"><i class="fa fa-check"></i><b>2</b> Classification</a><ul>
<li class="chapter" data-level="2.1" data-path="seminar2.html"><a href="seminar2.html#seminar"><i class="fa fa-check"></i><b>2.1</b> Seminar</a><ul>
<li class="chapter" data-level="2.1.1" data-path="seminar2.html"><a href="seminar2.html#the-non-western-foreigners-data-set"><i class="fa fa-check"></i><b>2.1.1</b> The Non-Western Foreigners Data Set</a></li>
<li class="chapter" data-level="2.1.2" data-path="seminar2.html"><a href="seminar2.html#logistic-regression"><i class="fa fa-check"></i><b>2.1.2</b> Logistic Regression</a></li>
<li class="chapter" data-level="2.1.3" data-path="seminar2.html"><a href="seminar2.html#the-logit-model"><i class="fa fa-check"></i><b>2.1.3</b> The logit model</a></li>
<li class="chapter" data-level="2.1.4" data-path="seminar2.html"><a href="seminar2.html#predict-outcomes-from-logit"><i class="fa fa-check"></i><b>2.1.4</b> Predict Outcomes from logit</a></li>
<li class="chapter" data-level="2.1.5" data-path="seminar2.html"><a href="seminar2.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>2.1.5</b> K-Nearest Neighbors</a></li>
<li class="chapter" data-level="2.1.6" data-path="seminar2.html"><a href="seminar2.html#model-the-underlying-continuous-process"><i class="fa fa-check"></i><b>2.1.6</b> Model the Underlying Continuous Process</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="seminar3.html"><a href="seminar3.html"><i class="fa fa-check"></i><b>3</b> Cross-Validation</a><ul>
<li class="chapter" data-level="3.1" data-path="seminar3.html"><a href="seminar3.html#seminar-1"><i class="fa fa-check"></i><b>3.1</b> Seminar</a><ul>
<li class="chapter" data-level="3.1.1" data-path="seminar3.html"><a href="seminar3.html#the-validation-set-approach"><i class="fa fa-check"></i><b>3.1.1</b> The Validation Set Approach</a></li>
<li class="chapter" data-level="3.1.2" data-path="seminar3.html"><a href="seminar3.html#leave-one-out-cross-validation-loocv"><i class="fa fa-check"></i><b>3.1.2</b> Leave-One-Out Cross-Validation (LOOCV)</a></li>
<li class="chapter" data-level="3.1.3" data-path="seminar3.html"><a href="seminar3.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>3.1.3</b> k-Fold Cross-Validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="seminar4.html"><a href="seminar4.html"><i class="fa fa-check"></i><b>4</b> Subset Selection</a><ul>
<li class="chapter" data-level="4.1" data-path="seminar4.html"><a href="seminar4.html#seminar-2"><i class="fa fa-check"></i><b>4.1</b> Seminar</a><ul>
<li class="chapter" data-level="4.1.1" data-path="seminar4.html"><a href="seminar4.html#subset-selection-methods"><i class="fa fa-check"></i><b>4.1.1</b> Subset Selection Methods</a></li>
<li class="chapter" data-level="4.1.2" data-path="seminar4.html"><a href="seminar4.html#best-subset-selection"><i class="fa fa-check"></i><b>4.1.2</b> Best Subset Selection</a></li>
<li class="chapter" data-level="4.1.3" data-path="seminar4.html"><a href="seminar4.html#forward-and-backward-stepwise-selection"><i class="fa fa-check"></i><b>4.1.3</b> Forward and Backward Stepwise Selection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="seminar5.html"><a href="seminar5.html"><i class="fa fa-check"></i><b>5</b> Regularisation</a><ul>
<li class="chapter" data-level="5.1" data-path="seminar5.html"><a href="seminar5.html#seminar-3"><i class="fa fa-check"></i><b>5.1</b> Seminar</a><ul>
<li class="chapter" data-level="5.1.1" data-path="seminar5.html"><a href="seminar5.html#ridge-regression-and-the-lasso"><i class="fa fa-check"></i><b>5.1.1</b> Ridge Regression and the Lasso</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="seminar6.html"><a href="seminar6.html"><i class="fa fa-check"></i><b>6</b> All non-linear (polynomials to splines)</a><ul>
<li class="chapter" data-level="6.1" data-path="seminar6.html"><a href="seminar6.html#seminar-4"><i class="fa fa-check"></i><b>6.1</b> Seminar</a><ul>
<li class="chapter" data-level="6.1.1" data-path="seminar6.html"><a href="seminar6.html#polynomial-regression"><i class="fa fa-check"></i><b>6.1.1</b> Polynomial Regression</a></li>
<li class="chapter" data-level="6.1.2" data-path="seminar6.html"><a href="seminar6.html#step-functions"><i class="fa fa-check"></i><b>6.1.2</b> Step Functions</a></li>
<li class="chapter" data-level="6.1.3" data-path="seminar6.html"><a href="seminar6.html#splines"><i class="fa fa-check"></i><b>6.1.3</b> Splines</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="seminar7.html"><a href="seminar7.html"><i class="fa fa-check"></i><b>7</b> Tree Based Models</a><ul>
<li class="chapter" data-level="7.1" data-path="seminar7.html"><a href="seminar7.html#seminar-5"><i class="fa fa-check"></i><b>7.1</b> Seminar</a><ul>
<li class="chapter" data-level="7.1.1" data-path="seminar7.html"><a href="seminar7.html#classification-trees"><i class="fa fa-check"></i><b>7.1.1</b> Classification Trees</a></li>
<li class="chapter" data-level="7.1.2" data-path="seminar7.html"><a href="seminar7.html#regression-trees"><i class="fa fa-check"></i><b>7.1.2</b> Regression Trees</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="seminar8.html"><a href="seminar8.html"><i class="fa fa-check"></i><b>8</b> Simulation and Monte Carlos</a><ul>
<li class="chapter" data-level="8.1" data-path="seminar8.html"><a href="seminar8.html#seminar-6"><i class="fa fa-check"></i><b>8.1</b> Seminar</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="all-non-linear-polynomials-to-splines" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> All non-linear (polynomials to splines)</h1>
<div id="seminar-4" class="section level2">
<h2><span class="header-section-number">6.1</span> Seminar</h2>
<p>In this exercise, we will learn how to model non-linearities in generalised linear models. This exercise is based on based on James et al. 2013. We begin by loading that <code>ISLR</code> package and attaching to the Wage dataset that we will be using throughout this exercise. When we attach a dataset, we do not need to write <code>dataset.name$variable.name</code> to access a variable but we can instead just write <code>variable.name</code> to access it.</p>
<p>Note: We need to install the <code>ISLR</code> package if it is not installed alread like so: <code>install.packages("ISLR")</code>
Note2: The <code>Wage</code> dataset is spelled with a capital W.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" title="1"><span class="co"># clear workspace, load ISLR, attach wage data set</span></a>
<a class="sourceLine" id="cb184-2" title="2"><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</a>
<a class="sourceLine" id="cb184-3" title="3"><span class="kw">library</span>(ISLR)</a>
<a class="sourceLine" id="cb184-4" title="4"><span class="kw">attach</span>(Wage)</a>
<a class="sourceLine" id="cb184-5" title="5">?Wage <span class="co"># codebook</span></a></code></pre></div>
<div id="polynomial-regression" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Polynomial Regression</h3>
<p>Let’s fit a linear model to predict <code>wage</code> with a forth-degree polynomial using the <code>poly()</code> function.</p>
<p>Note: The dependent variable <code>wage</code> is spelled with a lower case w.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" title="1"><span class="co"># linear regression on wage, with age up to a 4th degree polynomial</span></a>
<a class="sourceLine" id="cb185-2" title="2">fit &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(age, <span class="dv">4</span>), <span class="dt">data =</span> Wage)</a>
<a class="sourceLine" id="cb185-3" title="3"><span class="kw">coef</span>(<span class="kw">summary</span>(fit))</a></code></pre></div>
<pre><code>                Estimate Std. Error    t value     Pr(&gt;|t|)
(Intercept)    111.70361  0.7287409 153.283015 0.000000e+00
poly(age, 4)1  447.06785 39.9147851  11.200558 1.484604e-28
poly(age, 4)2 -478.31581 39.9147851 -11.983424 2.355831e-32
poly(age, 4)3  125.52169 39.9147851   3.144742 1.678622e-03
poly(age, 4)4  -77.91118 39.9147851  -1.951938 5.103865e-02</code></pre>
<p>We can also obtain raw instead of orthogonal polynomials by passing the <code>raw = TRUE</code> argument to <code>poly()</code>. The coefficients will change the fit should be largely unaffected. It is not advisable to use the raw argument because it introduces unnecessary multicollinearity into the model.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" title="1">fit2 &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(age, <span class="dv">4</span>, <span class="dt">raw =</span> <span class="ot">TRUE</span>), <span class="dt">data =</span> Wage)</a>
<a class="sourceLine" id="cb187-2" title="2"><span class="kw">coef</span>(<span class="kw">summary</span>(fit2))</a></code></pre></div>
<pre><code>                               Estimate   Std. Error   t value
(Intercept)               -1.841542e+02 6.004038e+01 -3.067172
poly(age, 4, raw = TRUE)1  2.124552e+01 5.886748e+00  3.609042
poly(age, 4, raw = TRUE)2 -5.638593e-01 2.061083e-01 -2.735743
poly(age, 4, raw = TRUE)3  6.810688e-03 3.065931e-03  2.221409
poly(age, 4, raw = TRUE)4 -3.203830e-05 1.641359e-05 -1.951938
                              Pr(&gt;|t|)
(Intercept)               0.0021802539
poly(age, 4, raw = TRUE)1 0.0003123618
poly(age, 4, raw = TRUE)2 0.0062606446
poly(age, 4, raw = TRUE)3 0.0263977518
poly(age, 4, raw = TRUE)4 0.0510386498</code></pre>
<p>There are several ways to specify polynomials. These are, however a little less convenient.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" title="1">fit2a &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age<span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age<span class="op">^</span><span class="dv">4</span>), <span class="dt">data =</span> Wage)</a>
<a class="sourceLine" id="cb189-2" title="2"><span class="kw">coef</span>(fit2a)</a></code></pre></div>
<pre><code>  (Intercept)           age      I(age^2)      I(age^3)      I(age^4) 
-1.841542e+02  2.124552e+01 -5.638593e-01  6.810688e-03 -3.203830e-05 </code></pre>
<p>A more compact version of the same example uses <code>cbind()</code> and eliminates the need to wrap each term in <code>I()</code>. The output is less readable though.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" title="1">fit2b &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">cbind</span>(age, age<span class="op">^</span><span class="dv">2</span>, age<span class="op">^</span><span class="dv">3</span>, age<span class="op">^</span><span class="dv">4</span>), <span class="dt">data =</span> Wage)</a>
<a class="sourceLine" id="cb191-2" title="2"><span class="kw">coef</span>(fit2b)</a></code></pre></div>
<pre><code>                       (Intercept) cbind(age, age^2, age^3, age^4)age 
                     -1.841542e+02                       2.124552e+01 
   cbind(age, age^2, age^3, age^4)    cbind(age, age^2, age^3, age^4) 
                     -5.638593e-01                       6.810688e-03 
   cbind(age, age^2, age^3, age^4) 
                     -3.203830e-05 </code></pre>
<p>We can create an age grid (minimum age to maximum age) and pass the grid to <code>predict()</code>. We can set the argument <code>se=TRUE</code> in the <code>predict()</code> function which will return a list that includes standard errors of the outcome. We can use these to an upper and lower bound of our estimate of <span class="math inline">\(y\)</span>.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" title="1"><span class="co"># minimum and maximum values of age variable</span></a>
<a class="sourceLine" id="cb193-2" title="2">agelims &lt;-<span class="st"> </span><span class="kw">range</span>(age) </a>
<a class="sourceLine" id="cb193-3" title="3">age.grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> agelims[<span class="dv">1</span>], <span class="dt">to =</span> agelims[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb193-4" title="4"></a>
<a class="sourceLine" id="cb193-5" title="5"><span class="co"># se=TRUE returns standard errors</span></a>
<a class="sourceLine" id="cb193-6" title="6">preds &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">newdata =</span> <span class="kw">list</span>(<span class="dt">age =</span> age.grid), <span class="dt">se =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb193-7" title="7"></a>
<a class="sourceLine" id="cb193-8" title="8"><span class="co"># confidence intervals as estimate + and - 2 standard deviations</span></a>
<a class="sourceLine" id="cb193-9" title="9">se.bands &lt;-<span class="st"> </span><span class="kw">cbind</span>(preds<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>preds<span class="op">$</span>se.fit, preds<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>preds<span class="op">$</span>se.fit)</a></code></pre></div>
<p>We can plot the data and add the fit from the degree-4 polynomial. We set the margins and outer margins in our plot the later plot a title that will be the overall title for two plots that we plot next to each other. The function <code>matlines()</code> lets us draw the lines fo the uncertainty bounds in one go.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" title="1"><span class="co"># set margins to plot title in margins</span></a>
<a class="sourceLine" id="cb194-2" title="2"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb194-3" title="3"></a>
<a class="sourceLine" id="cb194-4" title="4"><span class="kw">plot</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">jitter</span>(age,<span class="dv">2</span>), <span class="dt">xlim =</span> agelims, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="st">&quot;darkgrey&quot;</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>,</a>
<a class="sourceLine" id="cb194-5" title="5">     <span class="dt">xlab =</span> <span class="st">&quot;age&quot;</span>)</a>
<a class="sourceLine" id="cb194-6" title="6"></a>
<a class="sourceLine" id="cb194-7" title="7"><span class="co"># overall plot window title</span></a>
<a class="sourceLine" id="cb194-8" title="8"><span class="kw">title</span>(<span class="st">&quot;Degree -4 Polynomial &quot;</span>, <span class="dt">outer =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb194-9" title="9"></a>
<a class="sourceLine" id="cb194-10" title="10"><span class="co"># line for mean estimate</span></a>
<a class="sourceLine" id="cb194-11" title="11"><span class="kw">lines</span>(age.grid, preds<span class="op">$</span>fit, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb194-12" title="12"></a>
<a class="sourceLine" id="cb194-13" title="13"><span class="co"># ~95% ci&#39;s</span></a>
<a class="sourceLine" id="cb194-14" title="14"><span class="kw">matlines</span>(age.grid, se.bands, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="ml101_files/figure-html/unnamed-chunk-118-1.png" width="672" /></p>
<p>We compare the orthogonolized polynomials that we saved in the object called <code>fit</code> with the polynomials that plain polynomials sved in <code>fit2</code>. The difference will be close to <span class="math inline">\(0\)</span>. We predict the outcome from the fit with the raw polynomials and take the diffence to the fit with the independent linear combinations of the powers of age.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" title="1">preds2 &lt;-<span class="st"> </span><span class="kw">predict</span>(fit2, <span class="dt">newdata =</span> <span class="kw">list</span>(<span class="dt">age =</span> age.grid), <span class="dt">se =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb195-2" title="2"></a>
<a class="sourceLine" id="cb195-3" title="3"><span class="co"># average difference</span></a>
<a class="sourceLine" id="cb195-4" title="4"><span class="kw">mean</span>(preds<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span>preds2<span class="op">$</span>fit)</a></code></pre></div>
<pre><code>[1] -1.752311e-11</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" title="1"><span class="co"># maximum difference</span></a>
<a class="sourceLine" id="cb197-2" title="2"><span class="kw">max</span>(<span class="kw">abs</span>(preds<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span>preds2<span class="op">$</span>fit))</a></code></pre></div>
<pre><code>[1] 7.81597e-11</code></pre>
<p>When we have only predictor variable and and its powers we use the <code>coef()</code> function to see whether the powers of the variable improve in-sample model fit.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" title="1">fit<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(age, <span class="dv">5</span>), <span class="dt">data =</span> Wage)</a>
<a class="sourceLine" id="cb199-2" title="2"><span class="kw">coef</span>(<span class="kw">summary</span>(fit<span class="fl">.5</span>))</a></code></pre></div>
<pre><code>                Estimate Std. Error     t value     Pr(&gt;|t|)
(Intercept)    111.70361  0.7287647 153.2780243 0.000000e+00
poly(age, 5)1  447.06785 39.9160847  11.2001930 1.491111e-28
poly(age, 5)2 -478.31581 39.9160847 -11.9830341 2.367734e-32
poly(age, 5)3  125.52169 39.9160847   3.1446392 1.679213e-03
poly(age, 5)4  -77.91118 39.9160847  -1.9518743 5.104623e-02
poly(age, 5)5  -35.81289 39.9160847  -0.8972045 3.696820e-01</code></pre>
<p>With more variables, we use the <code>anova()</code> function and look at the F-test to decide whether in-sample fit improves by including powers of a variable.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" title="1">fit<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> Wage)</a>
<a class="sourceLine" id="cb201-2" title="2">fit<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(age, <span class="dv">2</span>), <span class="dt">data =</span> Wage)</a>
<a class="sourceLine" id="cb201-3" title="3">fit<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(age, <span class="dv">3</span>), <span class="dt">data =</span> Wage)</a>
<a class="sourceLine" id="cb201-4" title="4">fit<span class="fl">.4</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(age, <span class="dv">4</span>), <span class="dt">data =</span> Wage)</a>
<a class="sourceLine" id="cb201-5" title="5"><span class="kw">anova</span>(fit<span class="fl">.1</span>, fit<span class="fl">.2</span>, fit<span class="fl">.3</span>, fit<span class="fl">.4</span>, fit<span class="fl">.5</span>)</a></code></pre></div>
<pre><code>Analysis of Variance Table

Model 1: wage ~ age
Model 2: wage ~ poly(age, 2)
Model 3: wage ~ poly(age, 3)
Model 4: wage ~ poly(age, 4)
Model 5: wage ~ poly(age, 5)
  Res.Df     RSS Df Sum of Sq        F    Pr(&gt;F)    
1   2998 5022216                                    
2   2997 4793430  1    228786 143.5931 &lt; 2.2e-16 ***
3   2996 4777674  1     15756   9.8888  0.001679 ** 
4   2995 4771604  1      6070   3.8098  0.051046 .  
5   2994 4770322  1      1283   0.8050  0.369682    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>With <code>glm()</code> we can also fit a polynomial logistic regression. Here, we create a binary variable that is 1 if wage &gt; 250 and 0 otherwise.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" title="1">fit &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">I</span>(wage <span class="op">&gt;</span><span class="st"> </span><span class="dv">250</span>) <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(age, <span class="dv">4</span>), <span class="dt">data =</span> Wage, <span class="dt">family =</span> binomial)</a></code></pre></div>
<p>Similar to <code>lm()</code> we use the <code>predict()</code> function again and also obtain standard errors by setting <code>se=TRUE</code>.</p>
<p>Note: If we do <strong>not</strong> set <code>type="response"</code> in the <code>predict()</code> function, we get the latent <span class="math inline">\(y\)</span> as <span class="math inline">\(X\beta\)</span>. We have to send those values through the link function to get predicted probabilities. We do this, so that we can estimate the standard errors on the latent <span class="math inline">\(y\)</span>. We then send these through the link function as well. This ensures that our confidence intervals will never be outside the logical <span class="math inline">\([0, 1]\)</span> interval for probabilities. If we would not do this, we could get standard errors outside the <span class="math inline">\([0, 1]\)</span> interval.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" title="1"><span class="co"># predict latent y</span></a>
<a class="sourceLine" id="cb204-2" title="2">preds &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">newdata =</span> <span class="kw">list</span>(<span class="dt">age =</span> age.grid), <span class="dt">se =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb204-3" title="3"></a>
<a class="sourceLine" id="cb204-4" title="4"><span class="co"># send latent y through the link function</span></a>
<a class="sourceLine" id="cb204-5" title="5">pfit &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>preds<span class="op">$</span>fit))</a>
<a class="sourceLine" id="cb204-6" title="6"></a>
<a class="sourceLine" id="cb204-7" title="7"><span class="co"># error bands calculate on the latent y</span></a>
<a class="sourceLine" id="cb204-8" title="8">se.bands.logit &lt;-<span class="st"> </span><span class="kw">cbind</span>(preds<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>preds<span class="op">$</span>se.fit, preds<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>preds<span class="op">$</span>se.fit)</a>
<a class="sourceLine" id="cb204-9" title="9">se.bands &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>se.bands.logit))</a></code></pre></div>
<p>We add the results next to the plot where wage is continuous. With the <code>points()</code> function we add the actual data to the plot. The argument <code>pch="|"</code> draws a bar as the symbol for each point. Also notice the y-coordinate of each point. In the <code>plot()</code> function we set the range of the y-axis with <code>ylim = c(0, 0.2)</code> to range from <span class="math inline">\(0\)</span> to <span class="math inline">\(0.2\)</span>. If the true outcome is <span class="math inline">\(1\)</span> we want to draw the | at <span class="math inline">\(y=0.2\)</span> and otherwhise at <span class="math inline">\(y=0\)</span>. We achieve this with <code>I((wage &gt; 250)/5)</code>. Play around to see why.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" title="1"><span class="kw">plot</span>(<span class="kw">I</span>(wage <span class="op">&gt;</span><span class="st"> </span><span class="dv">250</span>) <span class="op">~</span><span class="st"> </span>age, <span class="dt">xlim =</span> agelims, <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>))</a>
<a class="sourceLine" id="cb205-2" title="2"><span class="co"># add data to the plot</span></a>
<a class="sourceLine" id="cb205-3" title="3"><span class="kw">points</span>(<span class="kw">jitter</span>(age), <span class="kw">I</span>((wage <span class="op">&gt;</span><span class="st"> </span><span class="dv">250</span>)<span class="op">/</span><span class="dv">5</span>) , <span class="dt">cex =</span> <span class="dv">1</span>, <span class="dt">pch =</span> <span class="st">&quot;|&quot;</span>, <span class="dt">col =</span> <span class="st">&quot; darkgrey &quot;</span>)</a>
<a class="sourceLine" id="cb205-4" title="4"><span class="co"># mean estimate</span></a>
<a class="sourceLine" id="cb205-5" title="5"><span class="kw">lines</span>(age.grid, pfit, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb205-6" title="6"><span class="co"># 95 ci</span></a>
<a class="sourceLine" id="cb205-7" title="7"><span class="kw">matlines</span>(age.grid, se.bands, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="ml101_files/figure-html/unnamed-chunk-125-1.png" width="672" /></p>
<p>Notice, that the confidence interval becomes very large in the range of the data where we have few data and no <span class="math inline">\(1\)</span>’s.</p>
</div>
<div id="step-functions" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Step Functions</h3>
<p>Instead of using polynomials to create a non-linear prediction, we could also use step functions. With step functions we fit different lines for different data ranges.</p>
<p>We use the <code>cut()</code> function to create equally spaced cutpoints in our data. We use the now categorical variable age as predictor in our linear model.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" title="1"><span class="co"># four equally spaced intervals of age</span></a>
<a class="sourceLine" id="cb206-2" title="2"><span class="kw">table</span>(<span class="kw">cut</span>(age, <span class="dv">4</span>))</a></code></pre></div>
<pre><code>
(17.9,33.5]   (33.5,49]   (49,64.5] (64.5,80.1] 
        750        1399         779          72 </code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1"><span class="co"># fit the linear regression with the factor variable age that has four categories</span></a>
<a class="sourceLine" id="cb208-2" title="2">fit &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">cut</span>(age, <span class="dv">4</span>), <span class="dt">data =</span> Wage)</a>
<a class="sourceLine" id="cb208-3" title="3"><span class="co"># the first category is the baseline.</span></a>
<a class="sourceLine" id="cb208-4" title="4"><span class="kw">coef</span>(<span class="kw">summary</span>(fit))</a></code></pre></div>
<pre><code>                        Estimate Std. Error   t value     Pr(&gt;|t|)
(Intercept)            94.158392   1.476069 63.789970 0.000000e+00
cut(age, 4)(33.5,49]   24.053491   1.829431 13.148074 1.982315e-38
cut(age, 4)(49,64.5]   23.664559   2.067958 11.443444 1.040750e-29
cut(age, 4)(64.5,80.1]  7.640592   4.987424  1.531972 1.256350e-01</code></pre>
</div>
<div id="splines" class="section level3">
<h3><span class="header-section-number">6.1.3</span> Splines</h3>
<p>We use the <code>splines</code> package to fit splines.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" title="1"><span class="kw">library</span>(splines)</a></code></pre></div>
<p>We first use <code>bs()</code> to generate a basis matrix for a polynomial spline and fit a model with knots at age 25, 40 and 60. <code>bs</code> will by default fit a cubic spline with the specified number of knots. To deviate from a cubic spline, change the argument <code>degree</code> to some other value.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" title="1">fit &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span><span class="kw">bs</span>(age, <span class="dt">knots =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>)), <span class="dt">data =</span> Wage)</a>
<a class="sourceLine" id="cb211-2" title="2">pred &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">newdata =</span> <span class="kw">list</span>(<span class="dt">age =</span> age.grid), <span class="dt">se =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb211-3" title="3"><span class="kw">par</span>( <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb211-4" title="4"><span class="kw">plot</span>(<span class="kw">jitter</span>(age,<span class="dv">2</span>), wage, <span class="dt">col =</span> <span class="st">&quot;gray&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;age&quot;</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb211-5" title="5"><span class="kw">lines</span>(age.grid, pred<span class="op">$</span>fit, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb211-6" title="6"><span class="kw">lines</span>(age.grid, pred<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pred<span class="op">$</span>se, <span class="dt">lty =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb211-7" title="7"><span class="kw">lines</span>(age.grid, pred<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pred<span class="op">$</span>se, <span class="dt">lty =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="ml101_files/figure-html/unnamed-chunk-128-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="seminar5.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="seminar7.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["ml101.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
