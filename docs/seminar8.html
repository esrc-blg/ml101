<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Simulation and Monte Carlos | Introduction to Data Science</title>
  <meta name="description" content="Chapter 8 Simulation and Monte Carlos | Introduction to Data Science" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Simulation and Monte Carlos | Introduction to Data Science" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Simulation and Monte Carlos | Introduction to Data Science" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="seminar7.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="lib/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="js/codefolding.js"></script>


<script>
$(document).ready(function () {
  window.initializeCodeFolding();
});
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="lib\bootstrap\3.3.7\css\bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="css\readthedocs.css" type="text/css" />
<link rel="stylesheet" href="css\custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this course</a></li>
<li class="chapter" data-level="1" data-path="seminar1.html"><a href="seminar1.html"><i class="fa fa-check"></i><b>1</b> Linear Regression</a><ul>
<li class="chapter" data-level="1.1" data-path="seminar1.html"><a href="seminar1.html#learning-objectives"><i class="fa fa-check"></i><b>1.1</b> Learning objectives</a><ul>
<li class="chapter" data-level="1.1.1" data-path="seminar1.html"><a href="seminar1.html#dplyr-package"><i class="fa fa-check"></i><b>1.1.1</b> Dplyr package</a></li>
<li class="chapter" data-level="1.1.2" data-path="seminar1.html"><a href="seminar1.html#visualizing-a-relationship-bw-two-continuous-variables"><i class="fa fa-check"></i><b>1.1.2</b> Visualizing a relationship b/w two continuous variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="seminar2.html"><a href="seminar2.html"><i class="fa fa-check"></i><b>2</b> Classification</a><ul>
<li class="chapter" data-level="2.1" data-path="seminar2.html"><a href="seminar2.html#seminar"><i class="fa fa-check"></i><b>2.1</b> Seminar</a><ul>
<li class="chapter" data-level="2.1.1" data-path="seminar2.html"><a href="seminar2.html#the-non-western-foreigners-data-set"><i class="fa fa-check"></i><b>2.1.1</b> The Non-Western Foreigners Data Set</a></li>
<li class="chapter" data-level="2.1.2" data-path="seminar2.html"><a href="seminar2.html#logistic-regression"><i class="fa fa-check"></i><b>2.1.2</b> Logistic Regression</a></li>
<li class="chapter" data-level="2.1.3" data-path="seminar2.html"><a href="seminar2.html#the-logit-model"><i class="fa fa-check"></i><b>2.1.3</b> The logit model</a></li>
<li class="chapter" data-level="2.1.4" data-path="seminar2.html"><a href="seminar2.html#predict-outcomes-from-logit"><i class="fa fa-check"></i><b>2.1.4</b> Predict Outcomes from logit</a></li>
<li class="chapter" data-level="2.1.5" data-path="seminar2.html"><a href="seminar2.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>2.1.5</b> K-Nearest Neighbors</a></li>
<li class="chapter" data-level="2.1.6" data-path="seminar2.html"><a href="seminar2.html#model-the-underlying-continuous-process"><i class="fa fa-check"></i><b>2.1.6</b> Model the Underlying Continuous Process</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="seminar3.html"><a href="seminar3.html"><i class="fa fa-check"></i><b>3</b> Cross-Validation</a><ul>
<li class="chapter" data-level="3.1" data-path="seminar3.html"><a href="seminar3.html#seminar-1"><i class="fa fa-check"></i><b>3.1</b> Seminar</a><ul>
<li class="chapter" data-level="3.1.1" data-path="seminar3.html"><a href="seminar3.html#the-validation-set-approach"><i class="fa fa-check"></i><b>3.1.1</b> The Validation Set Approach</a></li>
<li class="chapter" data-level="3.1.2" data-path="seminar3.html"><a href="seminar3.html#leave-one-out-cross-validation-loocv"><i class="fa fa-check"></i><b>3.1.2</b> Leave-One-Out Cross-Validation (LOOCV)</a></li>
<li class="chapter" data-level="3.1.3" data-path="seminar3.html"><a href="seminar3.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>3.1.3</b> k-Fold Cross-Validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="seminar4.html"><a href="seminar4.html"><i class="fa fa-check"></i><b>4</b> Subset Selection</a><ul>
<li class="chapter" data-level="4.1" data-path="seminar4.html"><a href="seminar4.html#seminar-2"><i class="fa fa-check"></i><b>4.1</b> Seminar</a><ul>
<li class="chapter" data-level="4.1.1" data-path="seminar4.html"><a href="seminar4.html#subset-selection-methods"><i class="fa fa-check"></i><b>4.1.1</b> Subset Selection Methods</a></li>
<li class="chapter" data-level="4.1.2" data-path="seminar4.html"><a href="seminar4.html#best-subset-selection"><i class="fa fa-check"></i><b>4.1.2</b> Best Subset Selection</a></li>
<li class="chapter" data-level="4.1.3" data-path="seminar4.html"><a href="seminar4.html#forward-and-backward-stepwise-selection"><i class="fa fa-check"></i><b>4.1.3</b> Forward and Backward Stepwise Selection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="seminar5.html"><a href="seminar5.html"><i class="fa fa-check"></i><b>5</b> Regularization</a><ul>
<li class="chapter" data-level="5.1" data-path="seminar5.html"><a href="seminar5.html#seminar-3"><i class="fa fa-check"></i><b>5.1</b> Seminar</a><ul>
<li class="chapter" data-level="5.1.1" data-path="seminar5.html"><a href="seminar5.html#ridge-regression-and-the-lasso"><i class="fa fa-check"></i><b>5.1.1</b> Ridge Regression and the Lasso</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="seminar6.html"><a href="seminar6.html"><i class="fa fa-check"></i><b>6</b> All non-linear (polynomials to splines)</a><ul>
<li class="chapter" data-level="6.1" data-path="seminar6.html"><a href="seminar6.html#seminar-4"><i class="fa fa-check"></i><b>6.1</b> Seminar</a><ul>
<li class="chapter" data-level="6.1.1" data-path="seminar6.html"><a href="seminar6.html#polynomial-regression"><i class="fa fa-check"></i><b>6.1.1</b> Polynomial Regression</a></li>
<li class="chapter" data-level="6.1.2" data-path="seminar6.html"><a href="seminar6.html#step-functions"><i class="fa fa-check"></i><b>6.1.2</b> Step Functions</a></li>
<li class="chapter" data-level="6.1.3" data-path="seminar6.html"><a href="seminar6.html#splines"><i class="fa fa-check"></i><b>6.1.3</b> Splines</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="seminar7.html"><a href="seminar7.html"><i class="fa fa-check"></i><b>7</b> Tree Based Models</a><ul>
<li class="chapter" data-level="7.1" data-path="seminar7.html"><a href="seminar7.html#seminar-5"><i class="fa fa-check"></i><b>7.1</b> Seminar</a><ul>
<li class="chapter" data-level="7.1.1" data-path="seminar7.html"><a href="seminar7.html#classification-trees"><i class="fa fa-check"></i><b>7.1.1</b> Classification Trees</a></li>
<li class="chapter" data-level="7.1.2" data-path="seminar7.html"><a href="seminar7.html#regression-trees"><i class="fa fa-check"></i><b>7.1.2</b> Regression Trees</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="seminar8.html"><a href="seminar8.html"><i class="fa fa-check"></i><b>8</b> Simulation and Monte Carlos</a><ul>
<li class="chapter" data-level="8.1" data-path="seminar8.html"><a href="seminar8.html#seminar-6"><i class="fa fa-check"></i><b>8.1</b> Seminar</a><ul>
<li class="chapter" data-level="8.1.1" data-path="seminar8.html"><a href="seminar8.html#monte-carlo-simulation"><i class="fa fa-check"></i><b>8.1.1</b> Monte Carlo simulation</a></li>
<li class="chapter" data-level="8.1.2" data-path="seminar8.html"><a href="seminar8.html#simulation-approach-to-uncertainty"><i class="fa fa-check"></i><b>8.1.2</b> Simulation approach to uncertainty</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simulation-and-monte-carlos" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Simulation and Monte Carlos</h1>
<div id="seminar-6" class="section level2">
<h2><span class="header-section-number">8.1</span> Seminar</h2>
<p>In this exercise, we introduce a simulation approach to quantifying uncertainty and Monte Carlo simulation.</p>
<div id="monte-carlo-simulation" class="section level3">
<h3><span class="header-section-number">8.1.1</span> Monte Carlo simulation</h3>
<p>In Monte Carlo simulation we create a fake data set were we define a causal model of the outcome directly. That way, we know what the true outcome has to be. We can then keep everything constant but make on change to our estimation to assess the effect of that change on our prediction accuracy. We could, for instance, be interested in finding out whether our prediction accuracy suffers when independent variables are highly correlated.</p>
<p>So, we set up an MC analysis to see whether problems of multicolinearity (high correlation between explanatory variables) go away as the sample size increases. The goal is to see how well we are able to retrieve the true value of <span class="math inline">\(\beta_{1}\)</span> for varying strengths of correlation and sample sizes.</p>
<p>The basic setup of the simulation is as follows:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" title="1"><span class="co"># the number of runs (simulations)</span></a>
<a class="sourceLine" id="cb274-2" title="2">sim.n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb274-3" title="3"></a>
<a class="sourceLine" id="cb274-4" title="4"><span class="co"># sequence of low to high correlation</span></a>
<a class="sourceLine" id="cb274-5" title="5">Rho &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="fl">.9</span>,<span class="dt">length.out=</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb274-6" title="6"></a>
<a class="sourceLine" id="cb274-7" title="7"><span class="co"># vector of sample sizes</span></a>
<a class="sourceLine" id="cb274-8" title="8">sample.N &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">2000</span>)</a></code></pre></div>
<p>We create a container <code>beta.catcher</code> that stores coefficient values for different simulations. The container is a 3-dimensional array where the first dimension is the number of simulations, the second is the sample size, the third is correlation.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" title="1"><span class="co"># rows = simulations, columns = sample size, layers = correlation</span></a>
<a class="sourceLine" id="cb275-2" title="2">beta.catcher &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>, <span class="kw">c</span>(sim.n, <span class="dv">4</span>, <span class="dv">10</span>))</a></code></pre></div>
<p>We start simulating. This will take a while because we are iterating through <span class="math inline">\(sim.n * Rho * sample.N\)</span> iterations, i.e. <span class="math inline">\(40,000\)</span> iterations. Each time we regress <span class="math inline">\(y\)</span> on our covariates.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" title="1"><span class="co"># loop over the correlations</span></a>
<a class="sourceLine" id="cb276-2" title="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Rho)){</a>
<a class="sourceLine" id="cb276-3" title="3">  </a>
<a class="sourceLine" id="cb276-4" title="4">  <span class="co"># loop over sample sizes</span></a>
<a class="sourceLine" id="cb276-5" title="5">  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>){</a>
<a class="sourceLine" id="cb276-6" title="6">    </a>
<a class="sourceLine" id="cb276-7" title="7">    <span class="co"># loop over the random draws (number of simulations)</span></a>
<a class="sourceLine" id="cb276-8" title="8">    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>sim.n){</a>
<a class="sourceLine" id="cb276-9" title="9">      </a>
<a class="sourceLine" id="cb276-10" title="10">      <span class="co"># current correlation</span></a>
<a class="sourceLine" id="cb276-11" title="11">      rho &lt;-<span class="st"> </span>Rho[i]</a>
<a class="sourceLine" id="cb276-12" title="12">      <span class="co"># current sample size</span></a>
<a class="sourceLine" id="cb276-13" title="13">      sample.n &lt;-<span class="st"> </span>sample.N[j] </a>
<a class="sourceLine" id="cb276-14" title="14">      <span class="co"># variance covariance matrix current corr on off-diagonal</span></a>
<a class="sourceLine" id="cb276-15" title="15">      varL &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span> (<span class="dv">1</span>,rho,rho,<span class="dv">1</span>) , <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb276-16" title="16">      <span class="co"># random draw of covariates as many as sample size</span></a>
<a class="sourceLine" id="cb276-17" title="17">      XX &lt;-<span class="st"> </span>MASS<span class="op">::</span><span class="kw">mvrnorm</span>(sample.n, <span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">2</span>), varL) </a>
<a class="sourceLine" id="cb276-18" title="18">      <span class="co"># random noise</span></a>
<a class="sourceLine" id="cb276-19" title="19">      e &lt;-<span class="st"> </span><span class="kw">rnorm</span>(sample.n)</a>
<a class="sourceLine" id="cb276-20" title="20">      <span class="co"># the true data generation process b1 = 1; b2 = 1</span></a>
<a class="sourceLine" id="cb276-21" title="21">      y &lt;-<span class="st"> </span>XX  <span class="op">%*%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>e</a>
<a class="sourceLine" id="cb276-22" title="22">      <span class="co"># we regress the true y on the covariates and extract beta 1</span></a>
<a class="sourceLine" id="cb276-23" title="23">      beta.catcher[k,j,i] &lt;-<span class="st"> </span><span class="kw">coef</span>(<span class="kw">lm</span>(y<span class="op">~</span>XX))[<span class="dv">2</span>]  </a>
<a class="sourceLine" id="cb276-24" title="24">      </a>
<a class="sourceLine" id="cb276-25" title="25">      } <span class="co"># end of loop over number of sims</span></a>
<a class="sourceLine" id="cb276-26" title="26">    } <span class="co"># end of loop over sample sizes</span></a>
<a class="sourceLine" id="cb276-27" title="27">  } <span class="co"># end of loop over correlations</span></a></code></pre></div>
<p>You can have a look at the container by calling it with <code>beta.catcher</code>. We remind ourselves of the dimensions with:</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" title="1"><span class="kw">dim</span>(beta.catcher)</a></code></pre></div>
<pre><code>[1] 1000    4   10</code></pre>
<p>We take the MSE of each coefficient estimate in the container. This is an element-wise operation so the resulting object <code>error.sq</code> has the same dimensions as the container.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" title="1">error.sq &lt;-<span class="st"> </span>(beta.catcher<span class="dv">-1</span>)<span class="op">^</span><span class="dv">2</span> </a></code></pre></div>
<p>We average over the simulations by taking the column means. This returns a matrix where the rows are now the different sample sizes (previously in the columns) and the columns are the correlations (previously in the layers). The <code>matrix mse.beta</code>, thus, has 4 rows and 10 columns.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb280-1" title="1">mse.beta1 &lt;-<span class="st"> </span><span class="kw">colMeans</span>(error.sq) </a></code></pre></div>
<p>To show the effect of multicolinearity for increasing levels of correlation and for increasing sample sizes, we plot correlation on the x-axis and the MSE on the y-axis in four plots where sample size increases by plot.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>))</a>
<a class="sourceLine" id="cb281-2" title="2"><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">9</span>)<span class="op">/</span><span class="dv">10</span>,mse.beta1[<span class="dv">1</span>,], <span class="dt">xlab=</span><span class="st">&quot;correlation&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean Squared Error&quot;</span>, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">main=</span><span class="st">&quot;N=100&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb281-3" title="3"><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">9</span>)<span class="op">/</span><span class="dv">10</span>,mse.beta1[<span class="dv">2</span>,], <span class="dt">xlab=</span><span class="st">&quot;correlation&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean Squared Error&quot;</span>, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">main=</span><span class="st">&quot;N=500&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb281-4" title="4"><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">9</span>)<span class="op">/</span><span class="dv">10</span>,mse.beta1[<span class="dv">3</span>,], <span class="dt">xlab=</span><span class="st">&quot;correlation&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean Squared Error&quot;</span>, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">main=</span><span class="st">&quot;N=1000&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb281-5" title="5"><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">9</span>)<span class="op">/</span><span class="dv">10</span>,mse.beta1[<span class="dv">4</span>,], <span class="dt">xlab=</span><span class="st">&quot;correlation&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean Squared Error&quot;</span>, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">main=</span><span class="st">&quot;N=2000&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>))</a></code></pre></div>
<p><img src="img/unnamed-chunk-178-1.png" style="width:90.0%" /></p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" title="1">error.abs &lt;-<span class="st"> </span><span class="kw">abs</span>(beta.catcher<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb282-2" title="2">mae.beta1 &lt;-<span class="st"> </span><span class="kw">colMeans</span>(error.abs)</a>
<a class="sourceLine" id="cb282-3" title="3"></a>
<a class="sourceLine" id="cb282-4" title="4"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>))</a>
<a class="sourceLine" id="cb282-5" title="5"><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">9</span>)<span class="op">/</span><span class="dv">10</span>,mae.beta1[<span class="dv">1</span>,], <span class="dt">xlab=</span><span class="st">&quot;correlation&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Means Absolute Error&quot;</span>, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">main=</span><span class="st">&quot;N=100&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb282-6" title="6"><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">9</span>)<span class="op">/</span><span class="dv">10</span>,mae.beta1[<span class="dv">2</span>,], <span class="dt">xlab=</span><span class="st">&quot;correlation&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Means Absolute Error&quot;</span>, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">main=</span><span class="st">&quot;N=500&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb282-7" title="7"><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">9</span>)<span class="op">/</span><span class="dv">10</span>,mae.beta1[<span class="dv">3</span>,], <span class="dt">xlab=</span><span class="st">&quot;correlation&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Means Absolute Error&quot;</span>, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">main=</span><span class="st">&quot;N=1000&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb282-8" title="8"><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">9</span>)<span class="op">/</span><span class="dv">10</span>,mae.beta1[<span class="dv">4</span>,], <span class="dt">xlab=</span><span class="st">&quot;correlation&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Means Absolute Error&quot;</span>, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">main=</span><span class="st">&quot;N=2000&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>))</a></code></pre></div>
<p><img src="img/unnamed-chunk-178-2.png" style="width:90.0%" /></p>
<p>The two take-aways are that (1) with increasing sample size the problem of multicolinearity decreases substantially and (2) bias increases exponentially with increasing levels of correlation.</p>
</div>
<div id="simulation-approach-to-uncertainty" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Simulation approach to uncertainty</h3>
<p>Simulation is the Swiss army knife of statistics. Quantifying the uncertainty of an outcome can be tough or even impossible algebraically. Even for the linear model we need to consider the standard errors of all coefficients and their covariance. The formulas can be tedious…</p>
<p><strong>For simulation, the process is always the same regardless of the model.</strong></p>
<p>We start by loading data and fitting a linear model on the unemployment rate.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" title="1"><span class="co"># clear workspace</span></a>
<a class="sourceLine" id="cb283-2" title="2"><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</a>
<a class="sourceLine" id="cb283-3" title="3"><span class="co"># load data</span></a>
<a class="sourceLine" id="cb283-4" title="4">df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://philippbroniecki.github.io/ML2017.io/data/communities.csv&quot;</span>)</a></code></pre></div>
<p><strong>Simulation step 1:</strong> Our coefficients each follow a sampling distribution. Jointly, they follow a multivariate distribution which is assumed to be multivariate normal.</p>
<p>To characterize the shape of the distribution we need to know its mean and its variance. The mean is our vector of coefficient point estimates. We extract it using <code>coef(model_name)</code>. The variance is the model uncertainty which lives in the variance-covariance matrix. We extract it with <code>vcov(model_name)</code>.</p>
<p>As we draw randomly from a distribution we want to set the random number generator with <code>set.seed()</code> to make our results replicable and we pick the number of coefficients to draw form the distribution (the number of simulations).</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" title="1"><span class="co"># run a model</span></a>
<a class="sourceLine" id="cb284-2" title="2">m1 &lt;-<span class="st"> </span><span class="kw">lm</span>(PctUnemployed <span class="op">~</span><span class="st"> </span>pctUrban <span class="op">+</span><span class="st"> </span>householdsize <span class="op">+</span><span class="st"> </span>racePctWhite, <span class="dt">data =</span> df)</a>
<a class="sourceLine" id="cb284-3" title="3"></a>
<a class="sourceLine" id="cb284-4" title="4"><span class="co"># set the random number generator to some value</span></a>
<a class="sourceLine" id="cb284-5" title="5"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb284-6" title="6"></a>
<a class="sourceLine" id="cb284-7" title="7"><span class="co"># pick how many coefficients you want to draw from the distribution</span></a>
<a class="sourceLine" id="cb284-8" title="8">n.sim &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb284-9" title="9"></a>
<a class="sourceLine" id="cb284-10" title="10"><span class="co"># draw coefficients from the multivariate normal</span></a>
<a class="sourceLine" id="cb284-11" title="11">S &lt;-<span class="st"> </span>MASS<span class="op">::</span><span class="kw">mvrnorm</span>(n.sim, <span class="kw">coef</span>(m1), <span class="kw">vcov</span>(m1))</a></code></pre></div>
<p><strong>Simulation step 2:</strong> Choose a scenario for which you want to make a prediction. That means we have to set our covariates to some value. We will vary the percentage of the urban population and keep all other covariates constant. We also check the range of the variable of interest so that we don’t extrapolate to something that is outside of our data range.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" title="1"><span class="co"># choose a scenario to predict the outcome for</span></a>
<a class="sourceLine" id="cb285-2" title="2"><span class="kw">summary</span>(df<span class="op">$</span>pctUrban)</a>
<a class="sourceLine" id="cb285-3" title="3"></a>
<a class="sourceLine" id="cb285-4" title="4"><span class="co"># set the covariates (predictions for changes in pctUrban)</span></a>
<a class="sourceLine" id="cb285-5" title="5">X &lt;-<span class="st"> </span><span class="kw">cbind</span>( <span class="dt">constant =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb285-6" title="6">            <span class="dt">urban =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.1</span>),</a>
<a class="sourceLine" id="cb285-7" title="7">            <span class="dt">householdsize =</span> <span class="kw">mean</span>(df<span class="op">$</span>householdsize),</a>
<a class="sourceLine" id="cb285-8" title="8">            <span class="dt">pctwhite =</span> <span class="kw">mean</span>(df<span class="op">$</span>racePctWhite))</a>
<a class="sourceLine" id="cb285-9" title="9"></a>
<a class="sourceLine" id="cb285-10" title="10"><span class="co"># check covariates</span></a>
<a class="sourceLine" id="cb285-11" title="11">X            </a></code></pre></div>
<pre><code>      constant urban householdsize  pctwhite
 [1,]        1   0.0     0.4633952 0.7537161
 [2,]        1   0.1     0.4633952 0.7537161
 [3,]        1   0.2     0.4633952 0.7537161
 [4,]        1   0.3     0.4633952 0.7537161
 [5,]        1   0.4     0.4633952 0.7537161
 [6,]        1   0.5     0.4633952 0.7537161
 [7,]        1   0.6     0.4633952 0.7537161
 [8,]        1   0.7     0.4633952 0.7537161
 [9,]        1   0.8     0.4633952 0.7537161
[10,]        1   0.9     0.4633952 0.7537161
[11,]        1   1.0     0.4633952 0.7537161</code></pre>
<p><strong>Simulation step 3:</strong> Predict the outcome. We have set our covariates and we have drawn our coefficients. This is all we need to predict <span class="math inline">\(y\)</span>. Depending on the flavor of generalized linear model, <span class="math inline">\(y\)</span> may have to be sent through a link function. In logistic regression we would send latent <span class="math inline">\(y\)</span> trough the logit link function: <span class="math inline">\(\frac{1}{1 + exp^{-y}}\)</span> to get probabilities that <span class="math inline">\(y\)</span> is 1. Here, we ran a simple linear model so in linear algebra notation our prediction is simply <span class="math inline">\(Y=X\beta\)</span>.</p>
<p>We estimate <code>y_hat</code> as a matrix where its rows are the number of simulations and its columns are the different covariate scenarios.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb287-1" title="1"><span class="co"># predict outcome, ie betas * X for all scenarios</span></a>
<a class="sourceLine" id="cb287-2" title="2">y_hat &lt;-<span class="st"> </span>S <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(<span class="kw">as.matrix</span>(X))</a></code></pre></div>
<p>Finally, all that is left is the interpretation of the result. We can simply look at the numerical outcomes similar to using the <code>summary()</code> function on the Zelig simulation object.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" title="1"><span class="co"># output like the zelig summary (including estimation uncertainty)</span></a>
<a class="sourceLine" id="cb288-2" title="2"><span class="kw">apply</span>(y_hat, <span class="dv">2</span>, quantile, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, <span class="fl">.5</span>, <span class="fl">.975</span>))</a></code></pre></div>
<pre><code>           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
2.5%  0.4316010 0.4214979 0.4105675 0.4000181 0.3893180 0.3784349
50%   0.4450405 0.4332109 0.4215157 0.4097547 0.3981805 0.3864607
97.5% 0.4584981 0.4454806 0.4327917 0.4198413 0.4070521 0.3945582
           [,7]      [,8]      [,9]     [,10]     [,11]
2.5%  0.3672170 0.3557150 0.3439413 0.3318641 0.3196062
50%   0.3747705 0.3630690 0.3512949 0.3396307 0.3279723
97.5% 0.3823658 0.3703668 0.3586515 0.3473086 0.3363178</code></pre>
<p>We can also draw a plot that shows our mean prediction and the uncertainty around in a few lines.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" title="1"><span class="co"># plot like zelig&#39;s ci plot</span></a>
<a class="sourceLine" id="cb290-2" title="2"><span class="kw">par</span>( <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb290-3" title="3"><span class="kw">plot</span>(<span class="dv">0</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Pct Urban&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Unemployment Rate&quot;</span>, </a>
<a class="sourceLine" id="cb290-4" title="4">     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="fl">0.5</span>), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">pch =</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb290-5" title="5">ci &lt;-<span class="st"> </span><span class="kw">apply</span>(y_hat, <span class="dv">2</span>, quantile, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, <span class="fl">.975</span>))</a>
<a class="sourceLine" id="cb290-6" title="6"><span class="kw">polygon</span>(<span class="dt">x =</span>  <span class="kw">c</span>(<span class="kw">rev</span>(X[,<span class="st">&quot;urban&quot;</span>]), X[,<span class="st">&quot;urban&quot;</span>]), </a>
<a class="sourceLine" id="cb290-7" title="7">        <span class="dt">y =</span> <span class="kw">c</span>(<span class="kw">rev</span>(<span class="kw">t</span>(ci)[,<span class="dv">2</span>]), <span class="kw">t</span>(ci)[,<span class="dv">1</span>]), <span class="dt">border =</span> <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb290-8" title="8">        <span class="dt">col =</span> <span class="st">&quot;lightblue&quot;</span>)</a>
<a class="sourceLine" id="cb290-9" title="9"><span class="kw">lines</span>(<span class="dt">x =</span> X[,<span class="st">&quot;urban&quot;</span>], <span class="dt">y =</span> <span class="kw">apply</span>(y_hat, <span class="dv">2</span>, quantile, <span class="dt">probs =</span> <span class="fl">.5</span>), <span class="dt">lwd =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="img/unnamed-chunk-184-1.png" style="width:90.0%" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="seminar7.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["ml101.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
